<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hottest Woman on the Internet â€” Elo Ranker (Supabase)</title>
  <meta name="description" content="Head-to-head Elo ranking of adult, consenting women creators (streamers, influencers, content creators)." />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root { color-scheme: light dark; }
    .card { box-shadow: 0 10px 25px rgba(0,0,0,.08); }
    .btn { transition: transform .05s ease; }
    .btn:active { transform: translateY(1px) scale(.99); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-white to-zinc-50 text-zinc-900 antialiased">
  <header class="max-w-6xl mx-auto px-4 py-6 flex items-center justify-between">
    <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">Hottest Woman on the Internet</h1>
    <nav class="flex flex-wrap items-center gap-2 text-sm">
      <button id="unlockBtn" type="button" class="btn rounded-xl px-3 py-2 border border-zinc-300 hover:bg-zinc-100 flex items-center gap-1">
        <span id="lockIcon">ðŸ”’</span><span id="lockLabel">Unlock Admin</span>
      </button>
      <button id="addBtn" type="button" class="btn rounded-xl px-4 py-2 bg-zinc-900 text-white hover:bg-zinc-800 hidden">Add Creator</button>
      <button id="refreshBtn" type="button" class="btn rounded-xl px-3 py-2 border border-zinc-300 hover:bg-zinc-100">Refresh</button>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-20">
    <!-- Arena -->
    <section aria-label="vote arena" class="mt-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <article id="cardA" class="card rounded-2xl overflow-hidden bg-white border border-zinc-200">
          <div class="aspect-[4/5] bg-zinc-100 overflow-hidden">
            <img id="imgA" alt="" class="w-full h-full object-cover" />
          </div>
          <div class="p-4 flex items-center justify-between gap-2">
            <div>
              <a id="nameA" href="#" class="text-lg font-semibold hover:underline"></a>
              <p id="tagA" class="text-xs text-zinc-500"></p>
            </div>
            <button id="voteA" type="button" class="btn rounded-xl px-5 py-2.5 bg-pink-600 text-white hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-400">Vote</button>
          </div>
        </article>

        <article id="cardB" class="card rounded-2xl overflow-hidden bg-white border border-zinc-200">
          <div class="aspect-[4/5] bg-zinc-100 overflow-hidden">
            <img id="imgB" alt="" class="w-full h-full object-cover" />
          </div>
          <div class="p-4 flex items-center justify-between gap-2">
            <div>
              <a id="nameB" href="#" class="text-lg font-semibold hover:underline"></a>
              <p id="tagB" class="text-xs text-zinc-500"></p>
            </div>
            <button id="voteB" type="button" class="btn rounded-xl px-5 py-2.5 bg-pink-600 text-white hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-400">Vote</button>
          </div>
        </article>
      </div>

      <div class="relative my-6">
        <div class="h-px bg-gradient-to-r from-transparent via-zinc-300 to-transparent"></div>
        <div class="absolute inset-0 flex items-center justify-center -mt-3">
          <span class="inline-flex items-center gap-2 bg-white px-4 py-1.5 rounded-full border border-zinc-200 text-xs font-medium">Head-to-Head Elo</span>
        </div>
      </div>
    </section>

    <!-- Leaderboard -->
    <section aria-label="leaderboard" class="mt-2">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-bold">Leaderboard</h2>
        <div class="text-xs text-zinc-500">Women creators â€¢ Click a name to view profile</div>
      </div>
      <div class="overflow-hidden rounded-2xl border border-zinc-200 bg-white">
        <table class="w-full text-sm">
          <thead class="bg-zinc-50 text-zinc-600">
            <tr>
              <th class="text-left p-3">#</th>
              <th class="text-left p-3">Creator</th>
              <th class="text-left p-3">Tags</th>
              <th class="text-right p-3">Elo</th>
              <th class="text-right p-3">W-L</th>
            </tr>
          </thead>
          <tbody id="board"></tbody>
        </table>
      </div>
    </section>

    <footer class="mt-10 text-xs text-zinc-500 leading-relaxed">
      <p><strong>Policy:</strong> This site lists <em>adult (18+), consenting women creators</em> (streamers, influencers, content creators). Submissions must confirm age and consent. Respectful conduct only.</p>
      <p>Backed by Supabase so your data persists across devices. For production, we can add proper auth & rate limits.</p>
    </footer>
  </main>

  <!-- Profile Modal -->
  <div id="profileModal" class="fixed inset-0 hidden z-50" role="dialog" aria-modal="true">
    <div id="overlayBg" class="absolute inset-0 bg-black/50"></div>
    <div id="profilePanel" class="relative mx-auto w-full sm:max-w-lg max-h-[90vh] mt-8 sm:mt-12 bg-white rounded-2xl overflow-hidden flex flex-col">
      <div class="flex items-center justify-between p-4 border-b border-zinc-200">
        <h3 id="profileName" class="text-lg font-bold"></h3>
        <div class="flex items-center gap-2">
          <button id="editBtn" type="button" class="btn hidden px-2 py-1 rounded-lg border border-blue-300 text-blue-700 hover:bg-blue-50">Edit</button>
          <button id="deleteBtn" type="button" class="btn hidden px-2 py-1 rounded-lg border border-red-300 text-red-600 hover:bg-red-50">Delete</button>
          <button id="closeModal" type="button" class="btn px-2 py-1 rounded-lg border border-zinc-300">Close</button>
        </div>
      </div>
      <div id="modalBody" class="flex-1 overflow-y-auto">
        <div id="profileView" class="grid grid-cols-2 gap-0">
          <div class="col-span-2 sm:col-span-1"><img id="profileImg" alt="" class="w-full h-full object-cover" /></div>
          <div class="col-span-2 sm:col-span-1 p-4 space-y-3">
            <p id="profileBio" class="text-sm text-zinc-700"></p>
            <div class="text-xs text-zinc-500"><span class="font-medium">Tags:</span> <span id="profileTags"></span></div>
            <div class="text-xs text-zinc-500"><span class="font-medium">Stats:</span> <span id="profileStats"></span></div>
            <div id="profileLinks" class="flex flex-wrap gap-2 pt-1"></div>
          </div>
        </div>
        <form id="profileEdit" class="hidden p-4 grid gap-3" autocomplete="off">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="space-y-2"><label class="text-xs text-zinc-600">Display name</label><input name="name" class="w-full rounded-xl border border-zinc-300 px-3 py-2"/></div>
            <div class="space-y-2"><label class="text-xs text-zinc-600">Image URL</label><input name="image" class="w-full rounded-xl border border-zinc-300 px-3 py-2"/></div>
          </div>
          <div class="space-y-2"><label class="text-xs text-zinc-600">Tags (comma-separated)</label><input name="tags" class="w-full rounded-xl border border-zinc-300 px-3 py-2"/></div>
          <div class="space-y-2"><label class="text-xs text-zinc-600">Bio</label><textarea name="bio" rows="3" class="w-full rounded-xl border border-zinc-300 px-3 py-2"></textarea></div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="space-y-2"><label class="text-xs text-zinc-600">X (Twitter) URL</label><input name="x" class="w-full rounded-xl border border-zinc-300 px-3 py-2"/></div>
            <div class="space-y-2"><label class="text-xs text-zinc-600">OnlyFans URL</label><input name="onlyfans" class="w-full rounded-xl border border-zinc-300 px-3 py-2"/></div>
          </div>
          <div class="space-y-2"><label class="text-xs text-zinc-600">Live preview</label><img id="editPreview" class="w-full aspect-[4/5] object-cover rounded-xl border border-zinc-200" alt="Preview"/></div>
        </form>
      </div>
      <div id="editFooter" class="hidden border-t bg-white p-3 flex items-center justify-end gap-2">
        <button id="cancelBtn" type="button" class="btn px-3 py-2 rounded-lg border border-zinc-300">Cancel</button>
        <button id="saveBtn" type="button" class="btn px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700">Save</button>
      </div>
    </div>
  </div>

  <!-- Add Creator (Admin) -->
  <div id="addModal" class="fixed inset-0 hidden z-50">
    <div class="absolute inset-0 bg-black/50"></div>
    <form id="addForm" class="relative bg-white w-full sm:max-w-lg mx-auto mt-8 sm:mt-12 rounded-2xl overflow-hidden" autocomplete="off">
      <div class="flex items-center justify-between p-4 border-b border-zinc-200">
        <h3 class="text-lg font-bold">Add Woman Creator (18+)</h3>
        <button type="button" id="closeAdd" class="btn px-2 py-1 rounded-lg border border-zinc-300">Close</button>
      </div>
      <div class="p-4 grid grid-cols-1 gap-3">
        <input name="name" required placeholder="Display name" class="w-full rounded-xl border border-zinc-300 px-3 py-2" />
        <input name="image" required placeholder="Portrait image URL (4:5 works best)" class="w-full rounded-xl border border-zinc-300 px-3 py-2" />
        <input name="tags" placeholder="Tags (comma-separated, e.g. streamer, influencer)" class="w-full rounded-xl border border-zinc-300 px-3 py-2" />
        <textarea name="bio" placeholder="Short bio (optional)" class="w-full rounded-xl border border-zinc-300 px-3 py-2"></textarea>
        <input name="x" placeholder="X (Twitter) profile URL (optional)" class="w-full rounded-xl border border-zinc-300 px-3 py-2" />
        <input name="onlyfans" placeholder="OnlyFans profile URL (optional)" class="w-full rounded-xl border border-zinc-300 px-3 py-2" />
        <label class="text-xs text-zinc-600 flex items-center gap-2"><input type="checkbox" name="adult" required class="accent-pink-600"> I confirm she is an adult (18+) and has consented to be listed.</label>
        <button class="btn rounded-xl px-5 py-2.5 bg-zinc-900 text-white hover:bg-zinc-800">Add</button>
      </div>
    </form>
  </div>

  <!-- Admin Unlock -->
  <div id="unlockModal" class="fixed inset-0 hidden z-50">
    <div class="absolute inset-0 bg-black/50"></div>
    <form id="unlockForm" class="relative bg-white w-full sm:max-w-xs mx-auto mt-24 rounded-2xl overflow-hidden">
      <div class="p-4 border-b border-zinc-200"><h3 class="text-lg font-bold">Admin Password</h3></div>
      <div class="p-4 grid gap-3">
        <input type="password" name="pass" placeholder="Enter password" class="w-full rounded-xl border border-zinc-300 px-3 py-2" autofocus />
        <div class="flex items-center justify-end gap-2">
          <button type="button" id="cancelUnlock" class="btn rounded-xl px-3 py-2 border border-zinc-300">Cancel</button>
          <button class="btn rounded-xl px-4 py-2 bg-zinc-900 text-white hover:bg-zinc-800">Unlock</button>
        </div>
        <p class="text-xs text-zinc-500">Demo-only UI lock. We will add real auth later.</p>
      </div>
    </form>
  </div>

  <script>
  const SUPABASE_URL = "https://otwbhhnneklouzbogggr.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im90d2JoaG5uZWtsb3V6Ym9nZ2dyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5NjI4MzcsImV4cCI6MjA3MzUzODgzN30.B-dzxz0ntOCNgAlHcVcqAnxYQ2ktJbhw512zK6g96Nk";
  const ADMIN_PASS = "123456abcdef";  // just the UI unlock password in this file
</script>


    // ===== 2) Admin password (client-side only, demo) =====
    const ADMIN_PASS = "changeme";

    // ===== Supabase client =====
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ===== Elo helpers =====
    function expectedScore(rA, rB) { return 1 / (1 + Math.pow(10, (rB - rA) / 400)); }
    function kFactor(elo) { if (elo < 1200) return 40; if (elo < 1600) return 32; if (elo < 2000) return 24; return 16; }
    function applyEloPair(a, b, winnerIsA) {
      const EA = expectedScore(a.elo, b.elo), EB = expectedScore(b.elo, a.elo);
      const KA = kFactor(a.elo), KB = kFactor(b.elo);
      if (winnerIsA) {
        a.elo = Math.round(a.elo + KA * (1 - EA)); a.wins++; b.elo = Math.round(b.elo + KB * (0 - EB)); b.losses++;
      } else {
        a.elo = Math.round(a.elo + KA * (0 - EA)); a.losses++; b.elo = Math.round(b.elo + KB * (1 - EB)); b.wins++;
      }
    }

    // ===== UI state =====
    let creators = [];
    let currentPair = [];
    let openProfileId = null;
    let editMode = false;

    const els = {
      imgA: document.getElementById("imgA"), imgB: document.getElementById("imgB"),
      nameA: document.getElementById("nameA"), nameB: document.getElementById("nameB"),
      tagA: document.getElementById("tagA"), tagB: document.getElementById("tagB"),
      voteA: document.getElementById("voteA"), voteB: document.getElementById("voteB"),
      board: document.getElementById("board"),
      addBtn: document.getElementById("addBtn"), refreshBtn: document.getElementById("refreshBtn"),
      unlockBtn: document.getElementById("unlockBtn"), lockIcon: document.getElementById("lockIcon"), lockLabel: document.getElementById("lockLabel"),
      profileModal: document.getElementById("profileModal"), profilePanel: document.getElementById("profilePanel"), overlayBg: document.getElementById("overlayBg"),
      profileName: document.getElementById("profileName"), profileImg: document.getElementById("profileImg"), profileBio: document.getElementById("profileBio"), profileTags: document.getElementById("profileTags"), profileStats: document.getElementById("profileStats"), profileLinks: document.getElementById("profileLinks"),
      profileView: document.getElementById("profileView"), profileEdit: document.getElementById("profileEdit"), editPreview: document.getElementById("editPreview"),
      editBtn: document.getElementById("editBtn"), deleteBtn: document.getElementById("deleteBtn"), closeModal: document.getElementById("closeModal"),
      editFooter: document.getElementById("editFooter"), cancelBtn: document.getElementById("cancelBtn"), saveBtn: document.getElementById("saveBtn"),
      addModal: document.getElementById("addModal"), addForm: document.getElementById("addForm"), closeAdd: document.getElementById("closeAdd"),
      unlockModal: document.getElementById("unlockModal"), unlockForm: document.getElementById("unlockForm"), cancelUnlock: document.getElementById("cancelUnlock"),
    };

    // Stop overlay close when dragging inside
    ["pointerdown","pointerup","mousedown","mouseup","click"].forEach(ev=>{
      els.profilePanel.addEventListener(ev, (e)=> e.stopPropagation(), { passive: true });
    });

    // ===== DB functions =====
    async function dbListCreators(){
      const { data, error } = await sb.from('creators').select('id, display_name, image_url, tags, bio, x_url, onlyfans_url, elo, wins, losses').order('elo', { ascending: false });
      if (error) throw error; return data || [];
    }
    async function dbInsertCreator(c){
      const { error } = await sb.from('creators').insert({
        display_name: c.name, image_url: c.image, tags: c.tags, bio: c.bio || null, x_url: c.x || null, onlyfans_url: c.onlyfans || null,
        elo: c.elo ?? 1200, wins: c.wins ?? 0, losses: c.losses ?? 0
      }); if (error) throw error;
    }
    async function dbUpdateCreator(id, patch){
      const map = { display_name: patch.name, image_url: patch.image, tags: patch.tags, bio: patch.bio, x_url: patch.x, onlyfans_url: patch.onlyfans };
      const update = {}; Object.keys(map).forEach(k=>{ if (map[k] !== undefined) update[k] = map[k]; });
      if (patch.elo !== undefined) update['elo'] = patch.elo;
      if (patch.wins !== undefined) update['wins'] = patch.wins;
      if (patch.losses !== undefined) update['losses'] = patch.losses;
      const { error } = await sb.from('creators').update(update).eq('id', id); if (error) throw error;
    }
    async function dbDeleteCreator(id){ const { error } = await sb.from('creators').delete().eq('id', id); if (error) throw error; }

    // ===== UI helpers =====
    function pickTwo(){
      if (creators.length < 2) return [];
      let i = Math.floor(Math.random() * creators.length); let j = i; while (j===i) j = Math.floor(Math.random() * creators.length);
      return [creators[i], creators[j]];
    }

    function renderArena(){
      currentPair = pickTwo();
      if (currentPair.length < 2) {
        els.imgA.src = els.imgB.src = ''; els.nameA.textContent = 'Add more creators'; els.nameB.textContent = ''; els.tagA.textContent = els.tagB.textContent = ''; return;
      }
      const [A,B] = currentPair;
      els.imgA.src = A.image_url; els.imgA.alt = A.display_name; els.imgB.src = B.image_url; els.imgB.alt = B.display_name;
      els.nameA.textContent = A.display_name; els.nameA.href = '#profile-'+A.id; els.nameB.textContent = B.display_name; els.nameB.href = '#profile-'+B.id;
      els.tagA.textContent = (A.tags||[]).slice(0,2).join(' Â· '); els.tagB.textContent = (B.tags||[]).slice(0,2).join(' Â· ');
    }

    function renderBoard(){
      const sorted = [...creators].sort((a,b)=>b.elo - a.elo);
      els.board.innerHTML = sorted.map((c,idx)=>`
        <tr class="${idx % 2 ? 'bg-white' : 'bg-zinc-50/60'}">
          <td class="p-3">${idx+1}</td>
          <td class="p-3"><a href="#profile-${c.id}" class="font-medium hover:underline">${c.display_name}</a></td>
          <td class="p-3 text-zinc-500">${(c.tags||[]).join(', ')}</td>
          <td class="p-3 text-right font-semibold">${c.elo}</td>
          <td class="p-3 text-right">${c.wins}-${c.losses}</td>
        </tr>
      `).join('');
    }

    function populateView(c){
      els.profileName.textContent = c.display_name;
      els.profileImg.src = c.image_url; els.profileImg.alt = c.display_name;
      els.profileBio.textContent = c.bio || 'â€”';
      els.profileTags.textContent = (c.tags||[]).join(', ') || 'â€”';
      els.profileStats.textContent = `Elo ${c.elo} â€¢ ${c.wins}-${c.losses}`;
      const links = [];
      if (c.x_url) links.push({label:'X', url:c.x_url});
      if (c.onlyfans_url) links.push({label:'OnlyFans', url:c.onlyfans_url});
      els.profileLinks.innerHTML = links.map(l=>`<a href="${l.url}" target="_blank" rel="noopener" class="px-2 py-1 rounded-lg border border-zinc-300 hover:bg-zinc-50 text-xs">${l.label}</a>`).join('');
    }

    function populateEdit(c){
      const f = els.profileEdit;
      f.name.value = c.display_name || ''; f.image.value = c.image_url || ''; f.tags.value = (c.tags||[]).join(', '); f.bio.value = c.bio || ''; f.x.value = c.x_url || ''; f.onlyfans.value = c.onlyfans_url || '';
      els.editPreview.src = c.image_url || '';
    }

    function toggleEdit(on){
      editMode = !!on;
      els.profileView.classList.toggle('hidden', editMode);
      els.profileEdit.classList.toggle('hidden', !editMode);
      els.editFooter.classList.toggle('hidden', !editMode);
      els.editBtn.classList.toggle('hidden', editMode);
      els.deleteBtn.classList.toggle('hidden', editMode);
    }

    function isAdmin(){ return sessionStorage.getItem('hwoi_is_admin') === '1'; }
    function updateAdminUI(){ const a = isAdmin(); els.addBtn.classList.toggle('hidden', !a); els.lockIcon.textContent = a ? 'ðŸ”“' : 'ðŸ”’'; els.lockLabel.textContent = a ? 'Admin Unlocked' : 'Unlock Admin'; if(openProfileId){ els.editBtn.classList.toggle('hidden', !a || editMode); els.deleteBtn.classList.toggle('hidden', !a || editMode); } }

    // ===== Event wiring =====
    els.voteA.addEventListener('click', async ()=>{
      if (currentPair.length < 2) return; const [A,B] = currentPair.map(x=> ({...x}));
      applyEloPair(A,B,true); await dbUpdateCreator(A.id, { elo:A.elo, wins:A.wins }); await dbUpdateCreator(B.id, { elo:B.elo, losses:B.losses });
      await refreshAll();
    });
    els.voteB.addEventListener('click', async ()=>{
      if (currentPair.length < 2) return; const [A,B] = currentPair.map(x=> ({...x}));
      applyEloPair(A,B,false); await dbUpdateCreator(A.id, { elo:A.elo, losses:A.losses }); await dbUpdateCreator(B.id, { elo:B.elo, wins:B.wins });
      await refreshAll();
    });

    window.addEventListener('hashchange', ()=>{ const m = location.hash.match(/^#profile-(.+)$/); if (m) openProfile(m[1]); });
    document.getElementById('nameA').addEventListener('click', (e)=>{ e.preventDefault(); if(currentPair[0]) openProfile(currentPair[0].id); });
    document.getElementById('nameB').addEventListener('click', (e)=>{ e.preventDefault(); if(currentPair[1]) openProfile(currentPair[1].id); });

    async function openProfile(id){
      const c = creators.find(x=>x.id===id); if (!c) return;
      openProfileId = id; populateView(c); toggleEdit(false);
      els.editBtn.classList.toggle('hidden', !isAdmin()); els.deleteBtn.classList.toggle('hidden', !isAdmin());
      document.getElementById('profileModal').classList.remove('hidden');
    }

    els.overlayBg.addEventListener('pointerdown', ()=> { if (!editMode) els.closeModal.click(); });
    els.closeModal.addEventListener('click', ()=>{ document.getElementById('profileModal').classList.add('hidden'); openProfileId=null; toggleEdit(false); });

    els.editBtn.addEventListener('click', ()=>{ if (!isAdmin()) return alert('Admin locked.'); const c = creators.find(x=>x.id===openProfileId); if (!c) return; populateEdit(c); toggleEdit(true); });
    els.profileEdit.image.addEventListener('input', ()=>{ els.editPreview.src = els.profileEdit.image.value.trim(); });

    els.saveBtn.addEventListener('click', async ()=>{
      if (!isAdmin()) return alert('Admin locked.'); if (!openProfileId) return;
      const f = els.profileEdit; const patch = { name:f.name.value.trim(), image:f.image.value.trim(), tags:f.tags.value.split(',').map(s=>s.trim()).filter(Boolean), bio:f.bio.value.trim(), x:f.x.value.trim(), onlyfans:f.onlyfans.value.trim() };
      if (!patch.name || !patch.image) return alert('Name and image required.');
      await dbUpdateCreator(openProfileId, patch); await refreshAll(); const c = creators.find(x=>x.id===openProfileId); if (c) populateView(c); toggleEdit(false);
      alert('Profile updated.');
    });
    els.cancelBtn.addEventListener('click', ()=>{ toggleEdit(false); if (openProfileId){ const c = creators.find(x=>x.id===openProfileId); if (c) populateView(c); } });

    els.deleteBtn.addEventListener('click', async ()=>{ if (!isAdmin()) return alert('Admin locked.'); if (!openProfileId) return; const c = creators.find(x=>x.id===openProfileId); if (!c) return; if(!confirm(`Delete "${c.display_name}"?`)) return; await dbDeleteCreator(openProfileId); document.getElementById('profileModal').classList.add('hidden'); openProfileId=null; await refreshAll(); });

    els.addBtn.addEventListener('click', ()=>{ if (!isAdmin()) return alert('Admin locked.'); document.getElementById('addModal').classList.remove('hidden'); });
    els.closeAdd.addEventListener('click', ()=>{ document.getElementById('addModal').classList.add('hidden'); });
    document.getElementById('addModal').addEventListener('click', (e)=> { if (e.target === document.getElementById('addModal')) els.closeAdd.click(); });

    els.addForm.addEventListener('submit', async (e)=>{
      e.preventDefault(); if (!isAdmin()) return alert('Admin locked.');
      const fd = new FormData(els.addForm); if (!fd.get('adult')) return alert('Adult & consent confirmation is required.');
      const c = { name:String(fd.get('name')||'').trim(), image:String(fd.get('image')||'').trim(), tags:String(fd.get('tags')||'').split(',').map(s=>s.trim()).filter(Boolean), bio:String(fd.get('bio')||'').trim(), x:String(fd.get('x')||'').trim(), onlyfans:String(fd.get('onlyfans')||'').trim(), elo:1200, wins:0, losses:0 };
      if (!c.name || !c.image) return alert('Name and image required.');
      await dbInsertCreator(c); document.getElementById('addModal').classList.add('hidden'); els.addForm.reset(); await refreshAll(); alert('Creator added.');
    });

    els.unlockBtn.addEventListener('click', ()=>{ const a = isAdmin(); if (a){ if (confirm('Lock admin?')) { sessionStorage.removeItem('hwoi_is_admin'); updateAdminUI(); } } else { document.getElementById('unlockModal').classList.remove('hidden'); } });
    els.cancelUnlock.addEventListener('click', ()=>{ document.getElementById('unlockModal').classList.add('hidden'); els.unlockForm.reset(); });
    document.getElementById('unlockModal').addEventListener('click', (e)=>{ if (e.target === document.getElementById('unlockModal')) els.cancelUnlock.click(); });
    els.unlockForm.addEventListener('submit', (e)=>{ e.preventDefault(); const fd = new FormData(els.unlockForm); const pass = String(fd.get('pass')||''); if (pass === ADMIN_PASS){ sessionStorage.setItem('hwoi_is_admin','1'); updateAdminUI(); els.cancelUnlock.click(); } else alert('Incorrect password.'); });

    els.refreshBtn.addEventListener('click', ()=> refreshAll());

    async function refreshAll(){ creators = await dbListCreators(); renderBoard(); renderArena(); }

    // ===== First load =====
    updateAdminUI(); refreshAll();
  </script>
</body>
</html>
