<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hottest Woman on the Internet â€” Elo Ranker</title>
  <meta name="description" content="Head-to-head Elo ranking of adult, consenting women creators (streamers, influencers, content creators)." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: light dark; }
    .card { box-shadow: 0 10px 25px rgba(0,0,0,.08); }
    .btn { transition: transform .05s ease; }
    .btn:active { transform: translateY(1px) scale(.99); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-white to-zinc-50 text-zinc-900 antialiased">
  <header class="max-w-6xl mx-auto px-4 py-6 flex items-center justify-between">
    <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">Hottest Woman on the Internet</h1>
    <nav class="flex flex-wrap items-center gap-2 text-sm">
      <button id="unlockBtn" type="button" class="btn rounded-xl px-3 py-2 border border-zinc-300 hover:bg-zinc-100 flex items-center gap-1">
        <span id="lockIcon">ðŸ”’</span><span id="lockLabel">Unlock Admin</span>
      </button>
      <button id="addBtn" type="button" class="btn rounded-xl px-4 py-2 bg-zinc-900 text-white hover:bg-zinc-800 hidden">Add Creator</button>
      <button id="exportBtn" type="button" class="btn rounded-xl px-3 py-2 border border-zinc-300 hover:bg-zinc-100">Export JSON</button>
      <label class="btn rounded-xl px-3 py-2 border border-zinc-300 hover:bg-zinc-100 cursor-pointer">
        Import JSON <input id="importInput" type="file" accept="application/json" class="hidden" />
      </label>
      <button id="resetBtn" type="button" class="btn rounded-xl px-3 py-2 border border-zinc-300 hover:bg-zinc-100">Reset Demo</button>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto px-4 pb-20">
    <!-- Arena -->
    <section aria-label="vote arena" class="mt-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <article id="cardA" class="card rounded-2xl overflow-hidden bg-white border border-zinc-200">
          <div class="aspect-[4/5] bg-zinc-100 overflow-hidden">
            <img id="imgA" alt="" class="w-full h-full object-cover" />
          </div>
          <div class="p-4 flex items-center justify-between gap-2">
            <div>
              <a id="nameA" href="#" class="text-lg font-semibold hover:underline"></a>
              <p id="tagA" class="text-xs text-zinc-500"></p>
            </div>
            <button id="voteA" type="button" class="btn rounded-xl px-5 py-2.5 bg-pink-600 text-white hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-400">Vote</button>
          </div>
        </article>

        <article id="cardB" class="card rounded-2xl overflow-hidden bg-white border border-zinc-200">
          <div class="aspect-[4/5] bg-zinc-100 overflow-hidden">
            <img id="imgB" alt="" class="w-full h-full object-cover" />
          </div>
          <div class="p-4 flex items-center justify-between gap-2">
            <div>
              <a id="nameB" href="#" class="text-lg font-semibold hover:underline"></a>
              <p id="tagB" class="text-xs text-zinc-500"></p>
            </div>
            <button id="voteB" type="button" class="btn rounded-xl px-5 py-2.5 bg-pink-600 text-white hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-400">Vote</button>
          </div>
        </article>
      </div>

      <div class="relative my-6">
        <div class="h-px bg-gradient-to-r from-transparent via-zinc-300 to-transparent"></div>
        <div class="absolute inset-0 flex items-center justify-center -mt-3">
          <span class="inline-flex items-center gap-2 bg-white px-4 py-1.5 rounded-full border border-zinc-200 text-xs font-medium">Head-to-Head Elo</span>
        </div>
      </div>
    </section>

    <!-- Leaderboard -->
    <section aria-label="leaderboard" class="mt-2">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-bold">Leaderboard</h2>
        <div class="text-xs text-zinc-500">Women creators â€¢ Click a name to view profile</div>
      </div>
      <div class="overflow-hidden rounded-2xl border border-zinc-200 bg-white">
        <table class="w-full text-sm">
          <thead class="bg-zinc-50 text-zinc-600">
            <tr>
              <th class="text-left p-3">#</th>
              <th class="text-left p-3">Creator</th>
              <th class="text-left p-3">Tags</th>
              <th class="text-right p-3">Elo</th>
              <th class="text-right p-3">W-L</th>
            </tr>
          </thead>
          <tbody id="board"></tbody>
        </table>
      </div>
    </section>

    <footer class="mt-10 text-xs text-zinc-500 leading-relaxed">
      <p><strong>Policy:</strong> This site lists <em>adult (18+), consenting women creators</em> (streamers, influencers, content creators). Submissions must confirm age and consent. Respectful conduct only.</p>
      <p>Demo stores data locally. For production, use the Next.js + Supabase setup below.</p>
    </footer>
  </main>

  <!-- Profile Modal -->
  <div id="profileModal" class="fixed inset-0 hidden items-end sm:items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/50"></div>
    <!-- Stop clicks from bubbling to overlay -->
    <div id="profilePanel" class="relative bg-white w-full sm:max-w-lg rounded-t-2xl sm:rounded-2xl overflow-hidden">
      <div class="flex items-center justify-between p-4 border-b border-zinc-200">
        <h3 id="profileName" class="text-lg font-bold"></h3>
        <div class="flex items-center gap-2">
          <button id="editBtn" type="button" class="btn hidden px-2 py-1 rounded-lg border border-blue-300 text-blue-700 hover:bg-blue-50">Edit</button>
          <button id="saveBtn" type="button" class="btn hidden px-2 py-1 rounded-lg bg-blue-600 text-white hover:bg-blue-700">Save</button>
          <button id="cancelBtn" type="button" class="btn hidden px-2 py-1 rounded-lg border border-zinc-300">Cancel</button>
          <button id="deleteBtn" type="button" class="btn hidden px-2 py-1 rounded-lg border border-red-300 text-red-600 hover:bg-red-50">Delete</button>
          <button id="closeModal" type="button" class="btn px-2 py-1 rounded-lg border border-zinc-300">Close</button>
        </div>
      </div>

      <!-- View Mode -->
      <div id="profileView" class="grid grid-cols-2 gap-0">
        <div class="col-span-2 sm:col-span-1">
          <img id="profileImg" alt="" class="w-full h-full object-cover" />
        </div>
        <div class="col-span-2 sm:col-span-1 p-4 space-y-3">
          <p id="profileBio" class="text-sm text-zinc-700"></p>
          <div class="text-xs text-zinc-500"><span class="font-medium">Tags:</span> <span id="profileTags"></span></div>
          <div class="text-xs text-zinc-500"><span class="font-medium">Stats:</span> <span id="profileStats"></span></div>
          <div id="profileLinks" class="flex flex-wrap gap-2 pt-1"></div>
        </div>
      </div>

      <!-- Edit Mode -->
      <form id="profileEdit" class="hidden p-4 grid gap-3" autocomplete="off">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div class="space-y-2">
            <label class="text-xs text-zinc-600">Display name</label>
            <input name="name" class="w-full rounded-xl border border-zinc-300 px-3 py-2" autocomplete="off" />
          </div>
          <div class="space-y-2">
            <label class="text-xs text-zinc-600">Image URL (portrait works best)</label>
            <input name="image" class="w-full rounded-xl border border-zinc-300 px-3 py-2" autocomplete="off" />
          </div>
        </div>
        <div class="space-y-2">
          <label class="text-xs text-zinc-600">Tags (comma-separated)</label>
          <input name="tags" class="w-full rounded-xl border border-zinc-300 px-3 py-2" autocomplete="off" />
        </div>
        <div class="space-y-2">
          <label class="text-xs text-zinc-600">Bio</label>
          <textarea name="bio" rows="3" class="w-full rounded-xl border border-zinc-300 px-3 py-2" autocomplete="off"></textarea>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div class="space-y-2">
            <label class="text-xs text-zinc-600">X (Twitter) URL</label>
            <input name="x" class="w-full rounded-xl border border-zinc-300 px-3 py-2" autocomplete="off" />
          </div>
          <div class="space-y-2">
            <label class="text-xs text-zinc-600">OnlyFans URL</label>
            <input name="onlyfans" class="w-full rounded-xl border border-zinc-300 px-3 py-2" autocomplete="off" />
          </div>
        </div>
        <div class="space-y-2">
          <label class="text-xs text-zinc-600">Live preview</label>
          <img id="editPreview" class="w-full aspect-[4/5] object-cover rounded-xl border border-zinc-200" alt="Preview" />
        </div>
      </form>
    </div>
  </div>

  <!-- Add Creator (Admin) -->
  <div id="addModal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/50"></div>
    <form id="addForm" class="relative bg-white w-full sm:max-w-lg rounded-2xl overflow-hidden" autocomplete="off">
      <div class="flex items-center justify-between p-4 border-b border-zinc-200">
        <h3 class="text-lg font-bold">Add Woman Creator (18+)</h3>
        <button type="button" id="closeAdd" class="btn px-2 py-1 rounded-lg border border-zinc-300">Close</button>
      </div>
      <div class="p-4 grid grid-cols-1 gap-3">
        <input required name="name" placeholder="Display name" class="w-full rounded-xl border border-zinc-300 px-3 py-2" />
        <input required name="image" placeholder="Portrait image URL (4:5 works best)" class="w-full rounded-xl border border-zinc-300 px-3 py-2" />
        <input name="tags" placeholder="Tags (comma-separated, e.g. streamer, influencer)" class="w-full rounded-xl border border-zinc-300 px-3 py-2" />
        <textarea name="bio" placeholder="Short bio (optional)" class="w-full rounded-xl border border-zinc-300 px-3 py-2"></textarea>
        <input name="x" placeholder="X (Twitter) profile URL (optional)" class="w-full rounded-xl border border-zinc-300 px-3 py-2" />
        <input name="onlyfans" placeholder="OnlyFans profile URL (optional)" class="w-full rounded-xl border border-zinc-300 px-3 py-2" />
        <label class="text-xs text-zinc-600 flex items-center gap-2">
          <input type="checkbox" name="adult" required class="accent-pink-600"> I confirm she is an adult (18+) and has consented to be listed.
        </label>
        <button class="btn rounded-xl px-5 py-2.5 bg-zinc-900 text-white hover:bg-zinc-800">Add</button>
      </div>
    </form>
  </div>

  <!-- Admin Unlock -->
  <div id="unlockModal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/50"></div>
    <form id="unlockForm" class="relative bg-white w-full sm:max-w-xs rounded-2xl overflow-hidden">
      <div class="p-4 border-b border-zinc-200">
        <h3 class="text-lg font-bold">Admin Password</h3>
      </div>
      <div class="p-4 grid gap-3">
        <input type="password" name="pass" placeholder="Enter password" class="w-full rounded-xl border border-zinc-300 px-3 py-2" autofocus />
        <div class="flex items-center justify-end gap-2">
          <button type="button" id="cancelUnlock" class="btn rounded-xl px-3 py-2 border border-zinc-300">Cancel</button>
          <button class="btn rounded-xl px-4 py-2 bg-zinc-900 text-white hover:bg-zinc-800">Unlock</button>
        </div>
        <p class="text-xs text-zinc-500">Demo only. Change the password constant in the code.</p>
      </div>
    </form>
  </div>

  <script>
    // ===== Admin password (demo only) =====
    const ADMIN_PASS = "changeme";

    // ===== Storage keys =====
    const STORAGE_KEY = "hwoi_creators_v5"; // bumped version
    const VOTE_LOG_KEY = "hwoi_vote_log_v5";
    const ADMIN_FLAG = "hwoi_is_admin";

    // ===== Default women creators (placeholders) =====
    const DEFAULT_CREATORS = [
      { id: crypto.randomUUID(), name: "Ava Hart",
        image: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=900&auto=format&fit=crop",
        tags: ["streamer","fitness"], bio: "Lifestyle & fitness creator.", x: "#", onlyfans: "#", elo: 1200, wins: 0, losses: 0 },
      { id: crypto.randomUUID(), name: "Maya Chen",
        image: "https://images.unsplash.com/photo-1544005317-3f6f2b1d2b09?q=80&w=900&auto=format&fit=crop",
        tags: ["tech","gaming"], bio: "Gamer & tech reviewer.", x: "#", onlyfans: "", elo: 1200, wins: 0, losses: 0 },
      { id: crypto.randomUUID(), name: "Luna Rossi",
        image: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?q=80&w=900&auto=format&fit=crop",
        tags: ["fashion","travel"], bio: "Fashion & travel vlogs.", x: "#", onlyfans: "#", elo: 1200, wins: 0, losses: 0 },
      { id: crypto.randomUUID(), name: "Noor Al-Khaled",
        image: "https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?q=80&w=900&auto=format&fit=crop",
        tags: ["beauty","skincare"], bio: "Skincare educator.", x: "#", onlyfans: "", elo: 1200, wins: 0, losses: 0 }
    ];

    // ===== Helpers =====
    function loadCreators() {
      const raw = localStorage.getItem(STORAGE_KEY);
      try { return raw ? JSON.parse(raw) : DEFAULT_CREATORS; }
      catch { return DEFAULT_CREATORS; }
    }
    function saveCreators(creators) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(creators));
    }
    function logVote(aId,bId,winnerId) {
      const log = JSON.parse(localStorage.getItem(VOTE_LOG_KEY) || "[]");
      log.push({ t: Date.now(), aId, bId, winnerId });
      localStorage.setItem(VOTE_LOG_KEY, JSON.stringify(log));
    }
    function assertCreatorShape(obj){
      return obj && typeof obj.id==="string" && typeof obj.name==="string" && typeof obj.image==="string";
    }

    // Export/Import
    function exportCreators() {
      const data = { version: 1, exportedAt: new Date().toISOString(), creators };
      const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "hwoi_creators.json";
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }
    async function importCreators(file) {
      try {
        const text = await file.text();
        const json = JSON.parse(text);
        const list = Array.isArray(json) ? json : json.creators;
        if (!Array.isArray(list)) throw new Error("Invalid JSON format");
        const cleaned = list.filter(assertCreatorShape);
        if (cleaned.length === 0) throw new Error("No valid creators found.");
        creators = cleaned;
        saveCreators(creators);
        renderBoard(); renderArena();
        alert(`Imported ${cleaned.length} creators.`);
      } catch (e) {
        alert("Import failed: " + e.message);
      }
    }

    // Elo
    function expectedScore(rA, rB) { return 1 / (1 + Math.pow(10, (rB - rA) / 400)); }
    function kFactor(elo) { if (elo < 1200) return 40; if (elo < 1600) return 32; if (elo < 2000) return 24; return 16; }
    function applyElo(a, b, winner) {
      const EA = expectedScore(a.elo, b.elo), EB = expectedScore(b.elo, a.elo);
      const KA = kFactor(a.elo), KB = kFactor(b.elo);
      if (winner === "A") { a.elo = Math.round(a.elo + KA * (1 - EA)); a.wins++; b.elo = Math.round(b.elo + KB * (0 - EB)); b.losses++; }
      else { a.elo = Math.round(a.elo + KA * (0 - EA)); a.losses++; b.elo = Math.round(b.elo + KB * (1 - EB)); b.wins++; }
    }

    // ===== UI state =====
    let creators = loadCreators();
    let currentPair = [];
    let openProfileId = null;
    let editMode = false;

    const els = {
      imgA: document.getElementById("imgA"),
      imgB: document.getElementById("imgB"),
      nameA: document.getElementById("nameA"),
      nameB: document.getElementById("nameB"),
      tagA: document.getElementById("tagA"),
      tagB: document.getElementById("tagB"),
      voteA: document.getElementById("voteA"),
      voteB: document.getElementById("voteB"),
      board: document.getElementById("board"),
      resetBtn: document.getElementById("resetBtn"),
      exportBtn: document.getElementById("exportBtn"),
      importInput: document.getElementById("importInput"),
      addBtn: document.getElementById("addBtn"),
      unlockBtn: document.getElementById("unlockBtn"),
      lockIcon: document.getElementById("lockIcon"),
      lockLabel: document.getElementById("lockLabel"),
      profileModal: document.getElementById("profileModal"),
      profilePanel: document.getElementById("profilePanel"),
      profileName: document.getElementById("profileName"),
      profileImg: document.getElementById("profileImg"),
      profileBio: document.getElementById("profileBio"),
      profileTags: document.getElementById("profileTags"),
      profileStats: document.getElementById("profileStats"),
      profileLinks: document.getElementById("profileLinks"),
      profileView: document.getElementById("profileView"),
      editBtn: document.getElementById("editBtn"),
      saveBtn: document.getElementById("saveBtn"),
      cancelBtn: document.getElementById("cancelBtn"),
      deleteBtn: document.getElementById("deleteBtn"),
      closeModal: document.getElementById("closeModal"),
      profileEdit: document.getElementById("profileEdit"),
      editPreview: document.getElementById("editPreview"),
      addModal: document.getElementById("addModal"),
      addForm: document.getElementById("addForm"),
      closeAdd: document.getElementById("closeAdd"),
      unlockModal: document.getElementById("unlockModal"),
      unlockForm: document.getElementById("unlockForm"),
      cancelUnlock: document.getElementById("cancelUnlock"),
    };

    // Donâ€™t let clicks inside the panel close the modal
    els.profilePanel.addEventListener("click", (e)=> e.stopPropagation());

    // Pick two distinct creators
    function pickTwo() {
      if (creators.length < 2) return [];
      let i = Math.floor(Math.random() * creators.length);
      let j = i;
      while (j === i) j = Math.floor(Math.random() * creators.length);
      return [creators[i], creators[j]];
    }

    function renderArena() {
      currentPair = pickTwo();
      if (currentPair.length < 2) {
        els.imgA.src = ""; els.imgB.src = "";
        els.nameA.textContent = "Add more creators"; els.nameB.textContent = "";
        els.tagA.textContent = ""; els.tagB.textContent = "";
        return;
      }
      const [A,B] = currentPair;
      els.imgA.src = A.image; els.imgA.alt = A.name;
      els.imgB.src = B.image; els.imgB.alt = B.name;
      els.nameA.textContent = A.name; els.nameA.href = "#profile-"+A.id;
      els.nameB.textContent = B.name; els.nameB.href = "#profile-"+B.id;
      els.tagA.textContent = A.tags?.slice(0,2).join(" Â· ") || "";
      els.tagB.textContent = B.tags?.slice(0,2).join(" Â· ") || "";
    }

    function renderBoard() {
      const sorted = [...creators].sort((a,b)=>b.elo - a.elo);
      els.board.innerHTML = sorted.map((c,idx)=>`
        <tr class="${idx % 2 ? 'bg-white' : 'bg-zinc-50/60'}">
          <td class="p-3">${idx+1}</td>
          <td class="p-3"><a href="#profile-${c.id}" class="font-medium hover:underline">${c.name}</a></td>
          <td class="p-3 text-zinc-500">${(c.tags||[]).join(", ")}</td>
          <td class="p-3 text-right font-semibold">${c.elo}</td>
          <td class="p-3 text-right">${c.wins}-${c.losses}</td>
        </tr>
      `).join("");
    }

    function populateView(c) {
      els.profileName.textContent = c.name;
      els.profileImg.src = c.image; els.profileImg.alt = c.name;
      els.profileBio.textContent = c.bio || "â€”";
      els.profileTags.textContent = (c.tags||[]).join(", ") || "â€”";
      els.profileStats.textContent = `Elo ${c.elo} â€¢ ${c.wins}-${c.losses}`;
      const links = [];
      if (c.x) links.push({label:"X", url:c.x});
      if (c.onlyfans) links.push({label:"OnlyFans", url:c.onlyfans});
      els.profileLinks.innerHTML = links.map(l=>`
        <a href="${l.url}" target="_blank" rel="noopener" class="px-2 py-1 rounded-lg border border-zinc-300 hover:bg-zinc-50 text-xs">${l.label}</a>
      `).join("");
    }

    function populateEdit(c) {
      const f = els.profileEdit;
      f.name.value = c.name || "";
      f.image.value = c.image || "";
      f.tags.value = (c.tags||[]).join(", ");
      f.bio.value = c.bio || "";
      f.x.value = c.x || "";
      f.onlyfans.value = c.onlyfans || "";
      els.editPreview.src = c.image || "";
    }

    function toggleEdit(on) {
      editMode = !!on;
      els.profileView.classList.toggle("hidden", editMode);
      els.profileEdit.classList.toggle("hidden", !editMode);
      els.editBtn.classList.toggle("hidden", !isAdmin());
      els.saveBtn.classList.toggle("hidden", !editMode);
      els.cancelBtn.classList.toggle("hidden", !editMode);
      els.deleteBtn.classList.toggle("hidden", editMode || !isAdmin());
    }

    function openProfile(id) {
      const c = creators.find(x=>x.id===id);
      if (!c) return;
      openProfileId = id;
      populateView(c);
      els.editBtn.classList.toggle("hidden", !isAdmin());
      els.deleteBtn.classList.toggle("hidden", !isAdmin());
      toggleEdit(false);
      els.profileModal.classList.remove("hidden");
      els.profileModal.classList.add("flex");
    }

    // Voting
    els.voteA.addEventListener("click", ()=> {
      if (currentPair.length<2) return;
      const [A,B] = currentPair;
      applyElo(A,B,"A"); saveCreators(creators); logVote(A.id,B.id,A.id);
      renderBoard(); renderArena();
    });
    els.voteB.addEventListener("click", ()=> {
      if (currentPair.length<2) return;
      const [A,B] = currentPair;
      applyElo(A,B,"B"); saveCreators(creators); logVote(A.id,B.id,B.id);
      renderBoard(); renderArena();
    });

    // Profile deep links
    window.addEventListener("hashchange", ()=>{
      const m = location.hash.match(/^#profile-(.+)$/);
      if (m) openProfile(m[1]);
    });
    document.getElementById("nameA").addEventListener("click",(e)=>{ e.preventDefault(); if(currentPair[0]) openProfile(currentPair[0].id); });
    document.getElementById("nameB").addEventListener("click",(e)=>{ e.preventDefault(); if(currentPair[1]) openProfile(currentPair[1].id); });

    // Close modals (overlay only)
    els.profileModal.addEventListener("click", (e)=> {
      if (e.target === els.profileModal) els.closeModal.click();
    });
    els.closeModal.addEventListener("click", ()=> {
      els.profileModal.classList.add("hidden");
      els.profileModal.classList.remove("flex");
      openProfileId = null;
      toggleEdit(false);
    });

    // ===== Delete creator (admin only) =====
    els.deleteBtn.addEventListener("click", ()=>{
      if (!isAdmin()) return alert("Admin locked.");
      if (!openProfileId) return;
      const c = creators.find(x=>x.id===openProfileId);
      if (!c) return;
      if (!confirm(`Delete "${c.name}"? This cannot be undone.`)) return;
      creators = creators.filter(x=>x.id !== openProfileId);
      saveCreators(creators);
      els.closeModal.click();
      renderBoard(); renderArena();
      alert("Creator deleted.");
    });

    // ===== Edit flow (admin only) =====
    function isAdmin(){ return sessionStorage.getItem(ADMIN_FLAG) === "1"; }

    els.editBtn.addEventListener("click", ()=>{
      if (!isAdmin()) return alert("Admin locked.");
      if (!openProfileId) return;
      const c = creators.find(x=>x.id===openProfileId);
      if (!c) return;
      populateEdit(c);
      toggleEdit(true);
    });

    // live preview while editing
    els.profileEdit.image.addEventListener("input", ()=>{
      els.editPreview.src = els.profileEdit.image.value.trim();
    });

    // prevent enter-key form submit closing modal; also allow Ctrl/Cmd+Enter to save
    els.profileEdit.addEventListener("submit", (e)=> {
      e.preventDefault();
      doSave();
    });
    els.profileEdit.addEventListener("keydown", (e)=> {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") { e.preventDefault(); doSave(); }
    });

    function doSave(){
      if (!isAdmin()) return alert("Admin locked.");
      if (!openProfileId) return;
      const f = els.profileEdit;
      const updated = {
        name: f.name.value.trim(),
        image: f.image.value.trim(),
        tags: f.tags.value.split(",").map(s=>s.trim()).filter(Boolean),
        bio: f.bio.value.trim(),
        x: f.x.value.trim(),
        onlyfans: f.onlyfans.value.trim(),
      };
      if (!updated.name || !updated.image) return alert("Name and image are required.");
      const idx = creators.findIndex(x=>x.id===openProfileId);
      if (idx === -1) return;
      creators[idx] = { ...creators[idx], ...updated };
      saveCreators(creators);
      populateView(creators[idx]);
      renderBoard();
      toggleEdit(false);
      alert("Profile updated.");
    }

    els.saveBtn.addEventListener("click", (e)=> { e.preventDefault(); doSave(); });
    els.cancelBtn.addEventListener("click", ()=> {
      toggleEdit(false);
      if (openProfileId) populateView(creators.find(x=>x.id===openProfileId) || {});
    });

    // ===== Admin gating =====
    function updateAdminUI() {
      const admin = isAdmin();
      els.addBtn.classList.toggle("hidden", !admin);
      els.lockIcon.textContent = admin ? "ðŸ”“" : "ðŸ”’";
      els.lockLabel.textContent = admin ? "Admin Unlocked" : "Unlock Admin";
      if (openProfileId !== null) {
        els.editBtn.classList.toggle("hidden", !admin);
        els.deleteBtn.classList.toggle("hidden", !admin || editMode);
      }
    }

    els.unlockBtn.addEventListener("click", ()=>{
      const admin = isAdmin();
      if (admin) {
        if (confirm("Lock admin?")) {
          sessionStorage.removeItem(ADMIN_FLAG);
          updateAdminUI();
        }
      } else {
        els.unlockModal.classList.remove("hidden");
        els.unlockModal.classList.add("flex");
        setTimeout(()=> {
          const inp = els.unlockForm.querySelector('input[name="pass"]');
          if (inp) inp.focus();
        }, 50);
      }
    });

    document.getElementById("cancelUnlock").addEventListener("click", ()=>{
      els.unlockModal.classList.add("hidden");
      els.unlockModal.classList.remove("flex");
      els.unlockForm.reset();
    });
    els.unlockModal.addEventListener("click", (e)=> { if (e.target === els.unlockModal) document.getElementById("cancelUnlock").click(); });
    els.unlockForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      const fd = new FormData(els.unlockForm);
      const pass = (fd.get("pass")||"").toString();
      if (pass === ADMIN_PASS) {
        sessionStorage.setItem(ADMIN_FLAG, "1");
        updateAdminUI();
        document.getElementById("cancelUnlock").click();
      } else {
        alert("Incorrect password.");
      }
    });

    // ===== Add creator (admin only) =====
    document.getElementById("addBtn").addEventListener("click", ()=>{
      if (!isAdmin()) return alert("Admin locked.");
      els.addModal.classList.remove("hidden");
      els.addModal.classList.add("flex");
    });
    els.closeAdd.addEventListener("click", ()=>{
      els.addModal.classList.add("hidden");
      els.addModal.classList.remove("flex");
    });
    els.addModal.addEventListener("click", (e)=> { if (e.target === els.addModal) els.closeAdd.click(); });

    els.addForm.addEventListener("submit", (e)=>{
      e.preventDefault();
      if (!isAdmin()) return alert("Admin locked.");
      const fd = new FormData(els.addForm);
      const isAdult = !!fd.get("adult");
      if (!isAdult) return alert("Adult & consent confirmation is required.");
      const creator = {
        id: crypto.randomUUID(),
        name: (fd.get("name")||"").toString().trim(),
        image: (fd.get("image")||"").toString().trim(),
        tags: (fd.get("tags")||"").toString().split(",").map(s=>s.trim()).filter(Boolean),
        bio: (fd.get("bio")||"").toString().trim(),
        x: (fd.get("x")||"").toString().trim(),
        onlyfans: (fd.get("onlyfans")||"").toString().trim(),
        elo: 1200, wins: 0, losses: 0
      };
      if (!creator.name || !creator.image) return alert("Name and image are required.");
      creators.push(creator);
      saveCreators(creators);
      renderBoard(); renderArena();
      els.closeAdd.click(); els.addForm.reset();
      alert("Creator saved.");
    });

    // Export/Import handlers
    els.exportBtn.addEventListener("click", exportCreators);
    els.importInput.addEventListener("change", (e)=>{
      const f = e.target.files?.[0];
      if (f) importCreators(f).finally(()=> { e.target.value = ""; });
    });

    // Reset
    els.resetBtn.addEventListener("click", ()=>{
      if (!confirm("Reset demo data? This clears your local list.")) return;
      localStorage.removeItem(STORAGE_KEY);
      localStorage.removeItem(VOTE_LOG_KEY);
      creators = loadCreators();
      renderBoard(); renderArena();
      scrollTo({top:0, behavior:"smooth"});
    });

    // Init
    updateAdminUI();
    renderBoard(); renderArena();
    const m = location.hash.match(/^#profile-(.+)$/);
    if (m) openProfile(m[1]);

    // Keep multiple tabs in sync
    window.addEventListener("storage", (e)=>{
      if (e.key === STORAGE_KEY) {
        try { creators = JSON.parse(e.newValue || "[]"); } catch {}
        renderBoard(); renderArena();
      }
    });
  </script>
</body>
</html>
